machine:
  services:
    - elasticsearch
  timezone:
    Asia/Tokyo
  ruby:
    version: 2.3.1
  environment:
    TEST_CLUSTER_COMMAND: /home/ubuntu/twitter_search/elasticsearch-2.3.4/bin/elasticsearch

dependencies:
  cache_directories:
    - elasticsearch-2.3.4
  pre:
    - cp dot.env .env
  post:
    - wget https://download.elastic.co/elasticsearch/elasticsearch/elasticsearch-2.3.4.tar.gz
    - tar -xvf elasticsearch-2.3.4.tar.gz
    - elasticsearch-2.3.4/bin/elasticsearch: {background: true}
    - sleep 10 && curl --retry 10 --retry-delay 5 -v http://127.0.0.1:9200/

test:
  override:
    - bundle exec rspec:
        parallel: true
        files:
          - spec/**/*_spec.rb
